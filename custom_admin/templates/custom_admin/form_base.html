{% extends 'custom_admin/base_admin.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ title }}{% endblock %}
{% block page_title %}{{ title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-2xl font-heading font-bold text-gray-900">{{ title }}</h1>
            {% if subtitle %}
                <p class="text-gray-600">{{ subtitle }}</p>
            {% endif %}
        </div>
        <div>
            <a href="{{ back_url }}" class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                <i class="fas fa-arrow-left mr-2"></i>
                Back
            </a>
        </div>
    </div>
    
    <!-- Form -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <form method="post" enctype="multipart/form-data" class="p-6 space-y-6">
            {% csrf_token %}
            
            <!-- Form Fields -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {% block form_fields %}
                    {% for field in form %}
                        <div class="{% if field.name in wide_fields %}lg:col-span-2{% endif %}">
                            <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-2">
                                {{ field.label }}
                                {% if field.field.required %}
                                    <span class="text-red-500">*</span>
                                {% endif %}
                            </label>
                            
                            {% if field.field.widget.input_type == 'textarea' %}
                                <textarea 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal resize-vertical min-h-[100px]"
                                    placeholder="{{ field.field.widget.attrs.placeholder|default:'' }}"
                                >{{ field.value|default:'' }}</textarea>
                            {% elif field.field.widget.input_type == 'select' %}
                                <select 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal"
                                >
                                    {% for choice in field.field.choices %}
                                        <option value="{{ choice.0 }}" {% if choice.0 == field.value %}selected{% endif %}>
                                            {{ choice.1 }}
                                        </option>
                                    {% endfor %}
                                </select>
                            {% elif field.field.widget.input_type == 'checkbox' %}
                                <div class="flex items-center">
                                    <input 
                                        type="checkbox" 
                                        name="{{ field.name }}" 
                                        id="{{ field.id_for_label }}"
                                        {% if field.value %}checked{% endif %}
                                        class="h-4 w-4 text-primary-teal focus:ring-primary-teal border-gray-300 rounded"
                                    >
                                    <label for="{{ field.id_for_label }}" class="ml-2 text-sm text-gray-700">
                                        {{ field.help_text|default:"Enable this option" }}
                                    </label>
                                </div>
                            {% elif field.field.widget.input_type == 'file' %}
                                <input 
                                    type="file" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-teal file:text-white hover:file:bg-cyan-600"
                                    accept="{{ field.field.widget.attrs.accept|default:'' }}"
                                >
                                {% if field.value %}
                                    <div class="mt-2 text-sm text-gray-500">
                                        Current: <a href="{{ field.value.url }}" target="_blank" class="text-primary-teal hover:underline">{{ field.value.name }}</a>
                                    </div>
                                {% endif %}
                            {% elif field.field.widget.input_type == 'datetime-local' %}
                                <input 
                                    type="datetime-local" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    value="{{ field.value|date:'Y-m-d\TH:i'|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal"
                                >
                            {% elif field.field.widget.input_type == 'date' %}
                                <input 
                                    type="date" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    value="{{ field.value|date:'Y-m-d'|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal"
                                >
                            {% elif field.field.widget.input_type == 'time' %}
                                <input 
                                    type="time" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    value="{{ field.value|time:'H:i'|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal"
                                >
                            {% else %}
                                <input 
                                    type="{{ field.field.widget.input_type|default:'text' }}" 
                                    name="{{ field.name }}" 
                                    id="{{ field.id_for_label }}"
                                    value="{{ field.value|default:'' }}"
                                    {% if field.field.required %}required{% endif %}
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-teal focus:border-primary-teal"
                                    placeholder="{{ field.field.widget.attrs.placeholder|default:'' }}"
                                >
                            {% endif %}
                            
                            {% if field.help_text and field.field.widget.input_type != 'checkbox' %}
                                <p class="mt-1 text-sm text-gray-500">{{ field.help_text }}</p>
                            {% endif %}
                            
                            {% if field.errors %}
                                <div class="mt-1">
                                    {% for error in field.errors %}
                                        <p class="text-sm text-red-600">{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    {% endfor %}
                {% endblock %}
            </div>
            
            <!-- Form Actions -->
            <div class="flex items-center justify-end space-x-4 pt-6 border-t border-gray-200">
                <a href="{{ back_url }}" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                    Cancel
                </a>
                <button 
                    type="submit"
                    class="px-6 py-2 bg-primary-teal text-white rounded-lg hover:bg-cyan-600 transition-colors duration-200 flex items-center"
                >
                    <i class="fas fa-save mr-2"></i>
                    {% block submit_text %}Save{% endblock %}
                </button>
            </div>
        </form>
    </div>
    
    {% block extra_content %}{% endblock %}
</div>

<script>
    // Auto-resize textareas
    document.addEventListener('DOMContentLoaded', function() {
        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
            // Initial resize
            textarea.style.height = textarea.scrollHeight + 'px';
        });
    });
    
    // File input preview
    document.addEventListener('DOMContentLoaded', function() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        fileInputs.forEach(input => {
            input.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        // Create preview if it's an image
                        if (file.type.startsWith('image/')) {
                            let preview = input.parentNode.querySelector('.file-preview');
                            if (!preview) {
                                preview = document.createElement('div');
                                preview.className = 'file-preview mt-2';
                                input.parentNode.appendChild(preview);
                            }
                            preview.innerHTML = `
                                <img src="${e.target.result}" alt="Preview" class="max-w-xs max-h-32 rounded-lg border border-gray-200">
                            `;
                        }
                    };
                    reader.readAsDataURL(file);
                }
            });
        });
    });
</script>
{% endblock %}
